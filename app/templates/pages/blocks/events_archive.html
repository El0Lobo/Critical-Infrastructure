{% load inline_edit i18n %}
{% if props.style_font_faces %}
  {% for css in props.style_font_faces %}
    <style>{{ css|safe }}</style>
  {% endfor %}
{% endif %}
<section class="page-block page-block--events-archive" {% if props.style_inline %}style="{{ props.style_inline }}"{% endif %}>
  <div class="page-block__container">
    {% if props.title %}
      <div class="page-block__header">
        {% with style=props.style_inline_targets.title %}
          <h2 {% if style %}style="{{ style }}"{% endif %} {% inline_attrs block 'title' %}>{{ props.title|inline_richtext }}</h2>
        {% endwith %}
        {% if props.subtitle %}
          {% with style=props.style_inline_targets.subtitle %}
            <p {% if style %}style="{{ style }}"{% endif %} {% inline_attrs block 'subtitle' %}>{{ props.subtitle|inline_richtext }}</p>
          {% endwith %}
        {% endif %}
      </div>
    {% endif %}

    <div class="page-events-archive" data-events-archive data-show-past-default="{% if props.include_past and not props.show_past_toggle %}true{% else %}false{% endif %}">
      {% if props.show_filters %}
        <div class="page-events-archive__filters">
          <button type="button" class="btn btn-xs is-active" data-filter-category="all">{% trans "All" %}</button>
          {% for category in event_categories %}
            <button type="button" class="btn btn-xs btn-outline-secondary" data-filter-category="{{ category.slug }}">{{ category.name }}</button>
          {% endfor %}
          {% if props.show_past_toggle and props.include_past %}
            <button type="button" class="btn btn-xs btn-outline-secondary" data-filter-past="toggle">{% trans "Show past" %}</button>
          {% endif %}
          {% if props.show_search %}
            <input type="text" class="page-events-archive__search" placeholder="{% trans 'Search events' %}" data-filter-search>
          {% endif %}
        </div>
      {% endif %}

      <div class="page-events-archive__grid">
        {% for event in events %}
          <article
            class="page-events-archive__card"
            data-event-title="{{ event.title|lower }}"
            data-event-categories="{{ event.category_slugs|join:','|lower }}"
            data-event-start="{{ event.effective_start }}"
          >
            {% if event.hero_image %}
              <div class="page-events-archive__image" style="background-image:url('{{ event.hero_image }}');"></div>
            {% endif %}
            <div class="page-events-archive__body">
              <p class="page-events-archive__meta">
                {% if event.effective_start %}
                  <time datetime="{{ event.effective_start }}">{{ event.effective_start|date:"D, M j Â· H:i" }}</time>
                {% endif %}
                {% if event.recurrence.description %}
                  <span class="badge">{{ event.recurrence.description }}</span>
                {% endif %}
              </p>
              <h3 class="page-events-archive__title">
                {% if event.url %}
                  <a href="{{ event.url }}">{{ event.title }}</a>
                {% else %}
                  {{ event.title }}
                {% endif %}
              </h3>
              {% if event.teaser %}<p class="page-events-archive__teaser">{{ event.teaser }}</p>{% endif %}
              {% if event.url %}
                <a class="btn btn-ghost" href="{{ event.url }}">{% trans "Details" %}</a>
              {% endif %}
            </div>
          </article>
        {% empty %}
          <p class="muted">{% trans "No events available." %}</p>
        {% endfor %}
      </div>
    </div>
  </div>
</section>
