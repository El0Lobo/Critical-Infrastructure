{% load inline_edit i18n %}
{% if props.style_font_faces %}
  {% for css in props.style_font_faces %}
    <style>{{ css|safe }}</style>
  {% endfor %}
{% endif %}
<section class="page-block page-block--events layout-{{ props.layout|default:'grid' }}" {% if props.style_inline %}style="{{ props.style_inline }}"{% endif %}>
  <div class="page-block__container">
    {% if props.title %}
      <div class="page-block__header">
        {% with style=props.style_inline_targets.title %}
          <h2 {% if style %}style="{{ style }}"{% endif %} {% inline_attrs block 'title' %}>{{ props.title|inline_richtext }}</h2>
        {% endwith %}
        {% if props.subtitle %}
          {% with style=props.style_inline_targets.subtitle %}
            <p {% if style %}style="{{ style }}"{% endif %} {% inline_attrs block 'subtitle' %}>{{ props.subtitle|inline_richtext }}</p>
          {% endwith %}
        {% endif %}
      </div>
    {% endif %}
    <div class="page-events">
      {% for event in events %}
        <article class="page-events__card">
          {% if event.hero_image %}
            <div class="page-events__image" style="background-image:url('{{ event.hero_image }}');"></div>
          {% endif %}
          <div class="page-events__body">
            <p class="page-events__meta">
              {% if event.effective_start %}
                <time datetime="{{ event.effective_start }}">{{ event.effective_start|date:"D, M j Â· H:i" }}</time>
              {% endif %}
              {% if event.recurrence.description %}
                <span class="badge">{{ event.recurrence.description }}</span>
              {% endif %}
            </p>
            <h3 class="page-events__title">
              {% if props.open_mode == 'modal' %}
                <button class="page-events__trigger" data-modal-open="event-{{ event.slug }}">{{ event.title }}</button>
              {% elif event.url %}
                <a href="{{ event.url }}">{{ event.title }}</a>
              {% else %}
                {{ event.title }}
              {% endif %}
            </h3>
            {% if event.teaser %}<p class="page-events__teaser">{{ event.teaser }}</p>{% endif %}
            {% if props.show_actions and event.url %}
              <a class="btn btn-ghost" href="{{ event.url }}">{% trans "Details" %}</a>
            {% endif %}
          </div>
        </article>
        {% if props.open_mode == 'modal' %}
          <div class="modal-overlay" id="event-{{ event.slug }}" hidden>
            <div class="modal-card dark" role="dialog" aria-modal="true" aria-labelledby="event-{{ event.slug }}-title">
              <header class="modal-header">
                <h2 id="event-{{ event.slug }}-title">{{ event.title }}</h2>
                <button type="button" class="btn btn-xs btn-outline-secondary" data-modal-close>{% trans "Close" %}</button>
              </header>
              <div class="modal-form">
                {% if event.hero_image %}
                  <img src="{{ event.hero_image }}" alt="{{ event.title }}" style="width:100%;border-radius:12px;">
                {% endif %}
                {% if event.teaser %}
                  <p>{{ event.teaser }}</p>
                {% endif %}
                {% if event.url %}
                  <div class="modal-actions">
                    <a class="btn btn-primary" href="{{ event.url }}">{% trans "Full event details" %}</a>
                  </div>
                {% endif %}
              </div>
            </div>
          </div>
        {% endif %}
      {% empty %}
        <p class="muted">{% trans "No events scheduled yet." %}</p>
      {% endfor %}
    </div>
  </div>
</section>
